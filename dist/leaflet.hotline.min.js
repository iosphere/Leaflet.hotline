/*!
 * (c) 2015, iosphere GmbH
 *  Leaflet.hotline, a Leaflet plugin for drawing gradients along polylines.
 *  https://github.com/iosphere/Leaflet.hotline/
 */
!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var i=n();for(var e in i)("object"==typeof exports?exports:t)[e]=i[e]}}(this,function(){return function(t){function n(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var i={};return n.m=t,n.c=i,n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=0)}([function(t,n,i){L.Util.Gradienter=i(1),L.HotlineUtil=L.extend(L.LineUtil,{clipSegment:function(t,n,i,e,o){var r,s,h,a=e?this._lastCode:L.LineUtil._getBitCode(t,i),l=L.LineUtil._getBitCode(n,i);for(this._lastCode=l;;){if(!(a|l))return[t,n];if(a&l)return!1;r=a||l,s=this._getEdgeIntersection(t,n,r,i,o),h=this._getBitCode(s,i),r===a?(s.z=t.z,t=s,a=h):(s.z=n.z,n=s,l=h)}},_simplifyDP:function(t,n){var i=t.length,e=typeof Uint8Array!=void 0+""?Uint8Array:Array,o=new e(i);o[0]=o[i-1]=1;for(var r=0,s=t.length;r<s;r++)t[r].cantBeDeleted&&(o[r]=1);this._simplifyDPStep(t,o,n,0,i-1);var h,a=[];for(h=0;h<i;h++)o[h]&&a.push(t[h]);return a},_reducePoints:function(t,n){for(var i=[t[0]],e=1,o=0,r=t.length;e<r;e++)(L.LineUtil._sqDist(t[e],t[o])>n||t[e].cantBeDeleted)&&(i.push(t[e]),o=e);return o<r-1&&i.push(t[r-1]),i}});var e=function(t,n){if(!(this instanceof e))return new e(t);var i={0:"green",.5:"yellow",1:"red"};this._map=n,this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._weight=5,this._min=0,this._max=1,this._data=[],this._dataOrigin=[],this.palette(i)};e.prototype={width:function(t){return this._width=t,this},height:function(t){return this._height=t,this},weight:function(t){return this._weight=t,this},zoomWeight:function(t){return this._zoomWeight=t,this},outlines:function(t){return this._outlines=t,this},palette:function(t){return this._palette=this.calcPalette(t),this},calcPalette:function(t){var n=document.createElement("canvas"),i=n.getContext("2d"),e=i.createLinearGradient(0,0,0,256);n.width=1,n.height=256;for(var o in t)e.addColorStop(o,t[o]);return i.fillStyle=e,i.fillRect(0,0,1,256),i.getImageData(0,0,1,256).data},unknownColor:function(t){var n=this.calcPalette([t]);return this._unknownColor=[n[0],n[1],n[2]],this},maxGradient:function(t){return this._maxGradient=t,this},minGradient:function(t){return this._minGradient=t,this},minColorLength:function(t){return this._minColorLength=t,this},gradientPercent:function(t){return this._gradientPercent=t,this},color:function(t){var n=this.calcPalette([t]);this._color=[n[0],n[1],n[2]]},min:function(t){return this._min=t,this},max:function(t){return this._max=t,this},data:function(t){this._dataOrigin=t;var n,i,e,o,r,s=[];for(n=0,e=t.length;n<e;n++){for(o=t[n],s[n]=[],i=0,r=o.length;i<r;i++)s[n][i]=L.point(o[i].x,o[i].y),s[n][i].z=o[i].z;s[n]=this.setGradientPoint(s[n])}return this._data=this.setRGBData(s),this},setGradientPoint:function(t){return new L.Util.Gradienter(t,{maxGradient:this._maxGradient,minGradient:this._minGradient,minColorLength:this._minColorLength,gradientPercent:this._gradientPercent}).getGradientPath()},setRGBData:function(t){var n,i,e,o,r,s,h,a;for(n=0,e=t.length;n<e;n++){for(o=t[n],i=0,r=o.length;i<r;i++)h=o[i],void 0!==h.z&&(h.rgb=this.getRBGForPoint(h));for(i=0,r=o.length;i<r;i++)s=o[i-1],h=o[i],a=o[i+1],h.rgb||(s&&a&&s.rgb&&a.rgb?h.rgb=[Math.floor((s.rgb[0]+a.rgb[0])/2),Math.floor((s.rgb[1]+a.rgb[1])/2),Math.floor((s.rgb[2]+a.rgb[2])/2)]:h.rgb=this.getRBGForPoint(h))}return t},getRBGForPoint:function(t){var n=t.rgb;return n||(n=void 0===t.z?this._color||this._unknownColor:-1===t.z?this._unknownColor:this.getRGBForValue(t.z)),n},add:function(t){return this.data(this._dataOrigin.push(t)),this},clear:function(t){return t&&(this._data=[]),this._ctx.clearRect(0,0,this._width,this._height),this},draw:function(t){var n=this._ctx;return n.globalCompositeOperation=t?"destination-out":"source-over",n.lineCap="round",n.lineJoin="round",this._drawOutlines(n,t),t?this:(this._drawHotline(n),n.fill(),this)},getRGBForValue:function(t){var n=Math.min(Math.max((t-this._min)/(this._max-this._min),0),.999),i=4*Math.floor(256*n);return[this._palette[i],this._palette[i+1],this._palette[i+2]]},_getActualWeight:function(t){t=t||this;var n=t._zoomWeight||t.zoomWeight;if(n&&n.length){var i,e=n.length,o=this._map.getZoom();for(i=0;i<e;i++)if(o>=n[i].zoom)return n[i].weight;return n[i-1].weight}return t._weight||t.weight},_drawOutlines:function(t,n){if(this._outlines){var i,e;for(i=0,e=this._outlines.length;i<e;i++)this._drawOutline(t,n,this._outlines[i].color,this._getActualWeight(this._outlines[i]))}},_drawOutline:function(t,n,i,e){var o,r,s,h,a,l,u,d=this._getActualWeight();if(n||e)for(o=0,s=this._data.length;o<s;o++)if(h=this._data[o],a=d+2*e,h._prevWidth=t.lineWidth=n?(h._prevWidth||a)+1:a,l=h.length){for(t.strokeStyle=i,t.beginPath(),t.moveTo(h[0].x,h[0].y),r=1,l=h.length;r<l;r++)u=h[r],t.lineTo(u.x,u.y);t.stroke()}},_drawHotline:function(t){var n,i,e,o,r,s,h,a,l,u,d=[];for(t.lineWidth=this._getActualWeight(),n=0,e=this._data.length;n<e;n++)for(o=this._data[n],i=1,r=o.length;i<r;i++)if(s=o[i-1],h=o[i],d.push(s),s.z!==h.z||i===r-1){var p=d[0];for(t.beginPath(),t.strokeStyle="rgb("+p.rgb.join(",")+")",t.moveTo(p.x,p.y),u=1,l=d.length;u<l;u++)t.lineTo(d[u].x,d[u].y);t.stroke(),d=[],a=t.createLinearGradient(s.x,s.y,h.x,h.y),a.addColorStop(0,"rgb("+s.rgb.join(",")+")"),a.addColorStop(1,"rgb("+h.rgb.join(",")+")"),t.strokeStyle=a,t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(h.x,h.y),t.stroke()}}},L.HotlineRenderer=L.Canvas.extend({_initContainer:function(){L.Canvas.prototype._initContainer.call(this),this._hotline=new e(this._container,this._map)},_update:function(){L.Canvas.prototype._update.call(this),this._hotline.width(this._container.width),this._hotline.height(this._container.height)},_updatePoly:function(t){this._redrawBounds=null;var n=t._parts;n.length&&(this._drawnLayers[t._leaflet_id]=t,this._updateOptions(t),this._hotline.data(n).draw(this._clear))},_updateOptions:function(t){t.options.hasOwnProperty("color")&&this._hotline.color(t.options.color),null!=t.options.min&&this._hotline.min(t.options.min),null!=t.options.max&&this._hotline.max(t.options.max),null!=t.options.weight&&this._hotline.weight(t.options.weight),null!=t.options.zoomWeight&&this._hotline.zoomWeight(t.options.zoomWeight),null!=t.options.outlines&&this._hotline.outlines(t.options.outlines),t.options.palette&&this._hotline.palette(t.options.palette),t.options.unknownColor&&this._hotline.unknownColor(t.options.unknownColor),t.options.maxGradient&&this._hotline.maxGradient(t.options.maxGradient),t.options.minGradient&&this._hotline.minGradient(t.options.minGradient),t.options.minColorLength&&this._hotline.minColorLength(t.options.minColorLength),t.options.gradientPercent&&this._hotline.gradientPercent(t.options.gradientPercent)}}),L.hotlineRenderer=function(t){return new L.HotlineRenderer(t)};var o=function(t){return L.Browser.canvas?L.hotlineRenderer(t):null};L.Hotline=L.Polyline.extend({statics:{Renderer:L.hotlineRenderer,renderer:o},options:{renderer:o(),min:0,max:1,palette:{0:"green",.5:"yellow",1:"red"},unknownColor:"#aaa",weight:6,zoomWeight:[{zoom:13,weight:5},{zoom:11,weight:4}],outlines:[{color:"#aaa",weight:4,zoomWeight:[{zoom:13,weight:4},{zoom:11,weight:3}]},{color:"white",weight:3,zoomWeight:[{zoom:13,weight:3},{zoom:11,weight:2}]}],maxGradient:30,minGradient:10,minColorLength:10,gradientPercent:30},getRGBForValue:function(t){return this._renderer._hotline.getRGBForValue(t)},_projectLatlngs:function(t,n,i){var e,o,r=t[0]instanceof L.LatLng,s=t.length;if(r){for(o=[],e=0;e<s;e++)o[e]=this._map.latLngToLayerPoint(t[e]),o[e].z=t[e].alt,i&&i.extend(o[e]);n.push(o)}else for(e=0;e<s;e++)this._projectLatlngs(t[e],n,i)},_simplifyPoints:function(){for(var t=this._parts,n=this.options.smoothFactor,i=0,e=t.length;i<e;i++){for(var o=t[i],r=0,s=o.length;r<s;r++)o[r].cantBeDeleted=!o[r-1]||o[r-1].z!==o[r].z||!o[r+1]||o[r+1].z!==o[r].z;t[i]=L.HotlineUtil.simplify(t[i],n)}},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var n,i,e,o,r,s,h,a=this._parts;for(n=0,e=0,o=this._rings.length;n<o;n++)for(h=this._rings[n],i=0,r=h.length;i<r-1;i++)(s=L.HotlineUtil.clipSegment(h[i],h[i+1],t,i,!0))&&(a[e]=a[e]||[],a[e].push(s[0]),s[1]===h[i+1]&&i!==r-2||(a[e].push(s[1]),e++))}},setOpacity:function(t){this._renderer&&this._renderer._hotline&&this._renderer._hotline._canvas&&(this._renderer._hotline._canvas.style.opacity=t)},_clickTolerance:function(){var t,n,i=[];for(t=0,n=this.options.outlines.length;t<n;t++)i.push(this.options.outlines[t].weight);return this.options.weight/2+Math.max.apply(this,i)+(L.Browser.touch?10:0)}}),L.hotline=function(t,n){return new L.Hotline(t,n)}},function(t,n){t.exports=function(){function t(t,n){n=n||{},this._data=t||[],this._grouped=[],this._gradientPercent=n.gradientPercent||30,this._minGradient=n.minGradient||10,this._minColorLength=n.minColorLength||20,this._maxGradient=n.maxGradient||30,this._needRecalc=!0}var n={findPointOnLine:function(t,n,i){if(0===i)return t;var e=t.x,o=t.y,r=n.x,s=n.y,h=[r-e,s-o],a=Math.sqrt(h[0]*h[0]+h[1]*h[1]),l=[h[0]/a,h[1]/a];return{x:e+i*l[0],y:o+i*l[1]}},distanceTo:function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}};return t.prototype._groupedByColor=function(){var t,n,i,e,o=[];for(t=0,n=this._data.length;t<n;t++)i=this._data[t],i.z===e?o.push(i):(o.length&&(1===o.length&&o.push(o[0]),this._grouped.push({points:o,color:o[0].z})),o=[i]),e=i.z;return o.length&&this._grouped.push({points:o,color:o[0].z}),this},t.prototype._setGroupsDistance=function(){var t,i,e,o,r,s,h,a=0;for(t=0,e=this._grouped.length;t<e;t++){for(o=this._grouped[t],a=0,i=0,r=o.points.length;i<r;i++)h=o.points[i],(s=o.points[i+1])&&(a+=n.distanceTo(h,s));o.distance=a,o.toDelete=this._minColorLength>o.distance}return this},t.prototype._cleanGrouped=function(){var t,n,i,e=[];for(t=0,n=this._grouped.length;t<n;t++)(i=this._grouped[t])&&i.points&&i.points.length&&e.push(this._grouped[t]);return this._grouped=e,this},t.prototype._setGradientsLength=function(){var t,n,i,e,o;for(t=0,i=this._grouped.length;t<i;t++)o=this._grouped[t-1],n=this._grouped[t],e=this._grouped[t+1],n.startGradient=0,o&&(n.startGradient=Math.floor(Math.min(o.distance,n.distance)*this._gradientPercent/100),n.startGradient=Math.max(Math.min(n.startGradient,this._maxGradient),this._minGradient)),n.endGradient=0,e&&(n.endGradient=Math.floor(Math.min(e.distance,n.distance)*this._gradientPercent/100),n.endGradient=Math.max(Math.min(n.endGradient,this._maxGradient),this._minGradient));return this},t.prototype.changePointsColor=function(t,n){var i,e;for(i=0,e=n.length;i<e;i++)n[i].z=t;return n},t.prototype._calculateGradientPoints=function(){var t,i,e,o,r,s,h,a,l=0;for(t=0,r=this._grouped.length;t<r;t++){if(s=this._grouped[t],s.startGradient){l=0;var u=0;for(i=0,h=s.points.length;i<h;i++){if(e=s.points[i],a=s.points[i+1],a&&(l+=n.distanceTo(e,a)),l>s.startGradient){o=n.findPointOnLine(e,a,s.startGradient-u),o.z=a.z,s.points=s.points.slice(0,i+1).concat([o]).concat(s.points.slice(i+1));break}u=l}}if(s.endGradient){l=0;var d;for(h=s.points.length-1,i=h;i>=0;i--)if(e=s.points[i],d=s.points[i-1],d&&(l+=n.distanceTo(e,d)),l>s.endGradient){o=n.findPointOnLine(d,e,l-s.endGradient),o.z=e.z,s.points=s.points.slice(0,i).concat([o]).concat(s.points.slice(i));break}}s.startGradient&&s.points[0]&&(s.points[0].z=void 0),s.endGradient&&s.points[s.points.length-1]&&(s.points[s.points.length-1].z=void 0)}return this},t.prototype._getPathByGrouped=function(){var t,n,i=[];for(t=0,n=this._grouped.length;t<n;t++){var e=this._grouped[t].points;t!==n-1&&e.pop(),i=i.concat(e)}return i},t.prototype._calculateGradientLength=function(){for(;this._needRecalc;)this._needRecalc=!1,this._setGroupsDistance()._deleteShortGroups();return this._setGradientsLength(),this},t.prototype._deleteShortGroups=function(){var t,n,i,e,o;for(t=0,i=this._grouped.length;t<i;t++)o=this._grouped[t-1],n=this._grouped[t],e=this._grouped[t+1],n.toDelete&&(o||e)&&(o&&(!e||o.distance>e.distance)?(n.points=this.changePointsColor(o.color,n.points),o.points=o.points.concat(n.points)):e&&(n.points=this.changePointsColor(e.color,n.points),e.points=n.points.concat(e.points)),delete this._grouped[t],this._needRecalc=!0);return this._cleanGrouped()},t.prototype.getGradientPath=function(){return this._groupedByColor()._calculateGradientLength()._calculateGradientPoints()._getPathByGrouped()},t}()}])});